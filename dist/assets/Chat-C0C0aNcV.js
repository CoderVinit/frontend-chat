import{j as e,c as re,u as $,r as t,d as oe,s as G,_ as C,e as _,l as ae,f as ie,h as le,i as ce,k as de,m as ue,n as me,S as N,g as ge,T as pe,I as fe,o as he}from"./index-BRYrtOYy.js";import{b as xe}from"./index-DdwGzNOV.js";import{M as je,a as ye}from"./Menu-Cy-i2GGQ.js";import{M as L,L as F}from"./MenuItem-CPgLDg1U.js";import{M as T}from"./Tooltip-BgeYST1d.js";import{c as y,T as E,M as B}from"./Modal-CADgA5Of.js";import{A as ve,N as O,S as D,a as P,b as Me}from"./AppLayout-BF_uULWe.js";import{h as Se,F as Ce,B as Ae}from"./Features-VHPfM-O5.js";import{R as be}from"./RenderAttachments-DCwrGZCb.js";import{u as Le,a as Fe}from"./Delete-BT8gj__Z.js";import"./AvatarCard-CUbOGxQa.js";import"./Toolbar-ITnAtlz5.js";import"./Group-BQiUClK4.js";import"./ExitToApp-U3kPwFHq.js";const Te=y(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),ke=y(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 11h-3v3.75c0 1.24-1.01 2.25-2.25 2.25S8.5 17.99 8.5 16.75s1.01-2.25 2.25-2.25c.46 0 .89.14 1.25.38V11h4zm-3-4V3.5L18.5 9z"}),"AudioFile"),Re=y(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),Ve=y(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),Ee=y(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Ie=y(e.jsx("path",{d:"M14 2H6.01c-1.1 0-2 .89-2 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-1 7V3.5L18.5 9zm1 5 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFile"),we=({anchorE1:s,chatId:f})=>{const{isFileMenu:i}=re(r=>r.misc),a=$(),u=t.useRef(null),m=t.useRef(null),j=t.useRef(null),l=t.useRef(null),[h]=oe(),x=()=>{a(G(!1))},o=r=>{var d;(d=r.current)==null||d.click()},c=async(r,d)=>{const v=Array.from(r.target.files);if(v.length<=0)return;if(v.length>5)return C.error(`You can only send 5 ${d} at a time`);a(_(!0));const M=C.loading(`Uploading ${d}....`);x();try{const g=new FormData;g.append("chatId",f),v.forEach(A=>{g.append("files",A)}),(await h(g)).data?C.success(` ${d} send Successfully`,{id:M}):C.error(`Failed to send ${d}`,{id:M})}catch(g){C.error(g,{id:M})}finally{a(_(!1))}};return e.jsx(je,{anchorEl:s,open:i,onClose:x,children:e.jsx("div",{style:{width:"10rem"},children:e.jsxs(ye,{children:[e.jsxs(L,{onClick:()=>o(u),children:[e.jsx(T,{title:"Image",children:e.jsx(Re,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Image"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/jpeg,image/png,image/gif,image/jpg",style:{display:"none"},onChange:r=>c(r,"Images"),ref:u})]}),e.jsxs(L,{onClick:()=>o(m),children:[e.jsx(T,{title:"Audio",children:e.jsx(ke,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Audio"}),e.jsx("input",{type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:r=>c(r,"Audios"),ref:m})]}),e.jsxs(L,{onClick:()=>o(j),children:[e.jsx(T,{title:"Video",children:e.jsx(Ie,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Videos"}),e.jsx("input",{type:"file",multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:r=>c(r,"Videos"),ref:j})]}),e.jsxs(L,{onClick:()=>o(l),children:[e.jsx(T,{title:"File",children:e.jsx(Ee,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Files"}),e.jsx("input",{type:"file",multiple:!0,accept:"*",style:{display:"none"},onChange:r=>c(r,"Files"),ref:l})]})]})})})},He=({message:s,user:f})=>{const{sender:i,content:a,attachments:u=[],createdAt:m}=s,j=Se(m).fromNow(),l=(i==null?void 0:i._id)===(f==null?void 0:f._id);return e.jsxs("div",{style:{alignSelf:l?"flex-end":"flex-start",color:"black",backgroundColor:"white",width:"fit-content",padding:"0.5rem",borderRadius:"5px"},children:[!l&&e.jsx(E,{color:ae,fontWeight:"600",variant:"caption",children:i.name}),a&&e.jsx(E,{children:a}),u.length>0&&u.map((h,x)=>{const o=h.url,c=Ce(o);return e.jsx(Ae,{children:e.jsx("a",{href:o,target:"_blank",rel:"noreferrer",download:!0,style:{color:"black"},children:be(c,o)})},x)}),e.jsx(E,{variant:"caption",color:"text.secondary",children:j})]})},ze=({chatId:s,user:f})=>{var w,H,z,U;const i=t.useRef(null),a=ie(),u=$(),m=t.useRef(null),j=le(),[l,h]=t.useState(""),[x,o]=t.useState([]),[c,r]=t.useState(1),[d,v]=t.useState(null),[M,g]=t.useState(!1),[I,A]=t.useState(!1),k=t.useRef(null),p=ce({chatId:s,skip:!s}),b=de({chatId:s,page:c}),{data:Y,setData:Q}=xe(i,(w=b.data)==null?void 0:w.totalPages,c,r,(H=b.data)==null?void 0:H.message),W=[{isError:p.isError,error:p.error},{isError:b.isError,error:b.error}],R=(U=(z=p==null?void 0:p.data)==null?void 0:z.chat)==null?void 0:U.members,X=n=>{n.preventDefault(),l.trim()&&(a.emit(O,{members:R,chatId:s,message:l}),h(""))};t.useEffect(()=>(u(ue(s)),()=>{o([]),Q([]),h(""),r(1)}),[s]);const q=n=>{h(n.target.value),M||(a.emit(D,{members:R,chatId:s}),g(!0)),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{a.emit(P,{members:R,chatId:s}),g(!1)},[2e3])};t.useEffect(()=>{m.current&&m.current.scrollIntoView({behavior:"smooth"})},[x]),t.useEffect(()=>{var n;if(!((n=p.data)!=null&&n.chat))return j("/")},[p.data]);const J=t.useCallback(n=>{n.chatId===s&&o(S=>[...S,n.message])},[s]),K=t.useCallback(n=>{n.chatId===s&&A(!0)},[s]),Z=t.useCallback(n=>{n.chatId===s&&A(!1)},[s]),ee=n=>{u(G(!0)),v(n.currentTarget)},se=t.useCallback(n=>{const S={content:n,sender:{_id:Math.random,name:"Admin"},chat:s,createdAt:new Date().toISOString()};o(ne=>[...ne,S])},[s]),te={[Me]:se,[O]:J,[D]:K,[P]:Z};Le(a,te),Fe(W);const V=[...Y,...x];return p.isLoading?e.jsx(me,{}):e.jsxs(e.Fragment,{children:[e.jsxs(N,{ref:i,boxSizing:"border-box",padding:"1rem",spacing:"1rem",bgcolor:ge,height:"90%",sx:{overflowX:"hidden",overflowY:"auto"},children:[V==null?void 0:V.map((n,S)=>e.jsx(He,{message:n,user:f.data},S)),I&&e.jsx(pe,{}),e.jsx("div",{ref:m})]}),e.jsx("form",{style:{height:"10%"},onSubmit:X,children:e.jsxs(N,{direction:"row",alignItems:"center",height:"100%",padding:"1rem",position:"relative",children:[e.jsx(B,{sx:{position:"absolute",rotate:"30deg",left:"1.5rem"},onClick:ee,children:e.jsx(Te,{})}),e.jsx(fe,{placeholder:"Type your message here....",value:l,onChange:q}),e.jsx(B,{type:"submit",sx:{backgroundColor:he,color:"white",marginLeft:"1rem",padding:"0.5rem","&:hover":{backgroundColor:"error.dark"}},children:e.jsx(Ve,{})})]})}),e.jsx(we,{anchorE1:d,chatId:s})]})},Je=ve()(ze);export{Je as default};
